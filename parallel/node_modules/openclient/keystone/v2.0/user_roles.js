var base = require("../../client/base"),
    error = require("../../client/error"),
    interpolate = require("../../client/utils").interpolate;


var UserRoleManager = base.Manager.extend({
  namespace: "/tenants/{tenant_id}/users/{user_id}/roles/OS-KSADM",
  plural: "roles",

  prepare_namespace: function (params) {
    return interpolate(this.namespace, {tenant_id: params.project, user_id: params.user});
  },

  get: function (params) { throw new error.NotImplemented(); },
  create: function (params, callback) {
    var projectId = params.project;

    if(projectId) {
      var url = this.get_base_url(params);
      params.url = url + "/" + params.role;
      delete params.project;
      delete params.user;
      delete params.role;
      this.update(params, callback)
    } else {
      var baseUrl = this.client.url_for(params.endpoint_type || this.endpoint_type),
          route = "/users/{user_id}/roles/OS-KSADM/{role_id}",
          url = baseUrl + interpolate(route, {user_id: params.user, role_id: params.role});
      params.url = url;
      this.update(params, callback);
    }

  },

  all: function (params, callback) {
    // Keystone's role listing URL doesn't have the extension affix in the URL.
    params.url = this.get_base_url(params).replace("/OS-KSADM", "");
    return this._super(params, callback);
  }
});


module.exports = UserRoleManager;
